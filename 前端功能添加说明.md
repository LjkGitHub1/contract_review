# 前端功能添加说明

## 已添加的前端功能

### 1. 合同起草AI生成功能 ✅

**位置：** `frontend/src/views/contracts/ContractCreate.vue`

**新增功能：**
- ✅ **基本信息填写对话框**：可以填写甲方、乙方、标的物、金额等基本信息
- ✅ **AI生成合同内容按钮**：点击后调用后端API生成合同内容
- ✅ **生成状态提示**：显示AI生成进度和结果

**使用流程：**
1. 选择合同类型和行业
2. 点击"填写基本信息"按钮，填写合同基本信息
3. 点击"AI生成合同内容"按钮
4. 系统自动生成合同内容并填充到内容框
5. 用户可以在此基础上进行编辑

**UI特点：**
- 使用卡片式布局，清晰展示AI生成功能
- 按钮状态管理（禁用/加载中）
- 成功提示和错误处理

---

### 2. 审核意见闭环功能 ✅

**位置：** `frontend/src/views/reviews/ReviewDetail.vue`

**新增功能：**
- ✅ **汇总审核意见按钮**：自动汇总各层级审核意见
- ✅ **意见汇总表展示**：
  - 按层级分组显示（一级/二级/三级）
  - 显示统计信息（总意见数、风险数量）
  - 支持切换查看不同层级的意见
- ✅ **反馈给起草人按钮**：将审核意见反馈给合同起草人
- ✅ **重新提交审核按钮**：起草人修改后重新提交审核

**使用流程：**
1. 在审核详情页面，点击"汇总审核意见"按钮
2. 查看汇总的审核意见（按层级分组）
3. 点击"反馈给起草人"按钮，将意见反馈给起草人
4. 起草人修改合同后，点击"重新提交审核"按钮
5. 系统创建新的审核任务

**UI特点：**
- 使用标签页切换不同层级的意见
- 表格展示意见详情
- 统计信息清晰展示
- 操作按钮状态管理

---

### 3. 合同提交审核功能 ✅

**位置：** `frontend/src/views/contracts/ContractDetail.vue`

**已有功能：**
- ✅ **提交审核按钮**：在合同详情页面可以直接提交审核
- ✅ **自动创建审核任务**：提交后自动创建自动审核任务

**使用流程：**
1. 在合同详情页面，点击"提交审核"按钮
2. 系统自动创建审核任务（类型：自动审核）
3. 跳转到审核任务列表页面

---

## 功能截图说明

### 合同创建页面
```
┌─────────────────────────────────────┐
│ 新建合同                            │
├─────────────────────────────────────┤
│ 合同标题: [____________]            │
│ 合同类型: [下拉选择]                │
│ 所属行业: [____________]            │
│ 使用模板: [下拉选择]                │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ AI智能生成                      │ │
│ │ [填写基本信息] [AI生成合同内容] │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 上传文件: [选择文件]                │
│ 合同内容: [文本域]                  │
│                                     │
│ [保存] [取消]                       │
└─────────────────────────────────────┘
```

### 审核详情页面
```
┌─────────────────────────────────────┐
│ 审核详情                            │
├─────────────────────────────────────┤
│ 总体评分: 85分                      │
│ 风险等级: 中风险                    │
│ 风险数量: 3                         │
│                                     │
│ ──── 审核摘要 ────                  │
│ 合同审核完成，发现3个中等风险点      │
│                                     │
│ ──── 审核意见 ────                  │
│ [意见表格]                          │
│                                     │
│ ──── 审核意见闭环 ────              │
│ ┌─────────────────────────────────┐ │
│ │ 意见汇总与反馈                  │ │
│ │ [汇总审核意见]                  │ │
│ │                                 │ │
│ │ 总意见数: 10                    │ │
│ │ 高风险: 2  中风险: 5  低风险: 3 │ │
│ │                                 │ │
│ │ [一级] [二级] [三级] [全部]     │ │
│ │ [意见表格]                      │ │
│ │                                 │ │
│ │ [反馈给起草人] [重新提交审核]   │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
```

---

## API调用说明

### 1. AI生成合同内容
```javascript
POST /api/contracts/contracts/generate_content/
{
  "contract_type": "service",
  "industry": "IT",
  "template_id": 1,  // 可选
  "basic_info": {
    "party_a": "甲方公司",
    "party_b": "乙方公司",
    "subject": "软件服务",
    "amount": "100万元"
  }
}
```

### 2. 汇总审核意见
```javascript
POST /api/reviews/cycles/summarize_opinions/
{
  "contract_id": 1,
  "review_task_ids": [1, 2, 3]  // 可选
}
```

### 3. 反馈给起草人
```javascript
POST /api/reviews/cycles/feedback_to_drafter/
{
  "contract_id": 1,
  "summary_table": {...},  // 可选，会自动生成
  "feedback_message": "请根据审核意见修改合同"
}
```

### 4. 重新提交审核
```javascript
POST /api/reviews/cycles/resubmit_for_review/
{
  "contract_id": 1,
  "change_summary": "根据审核意见修改了违约责任条款"
}
```

---

## 注意事项

1. **AI生成功能**：
   - 需要先选择合同类型
   - 需要填写至少甲方和乙方信息
   - 如果AI服务未配置，会使用模板生成

2. **审核意见闭环**：
   - 需要先有审核结果才能汇总意见
   - 反馈给起草人后，合同状态会更新
   - 重新提交会创建新的审核任务

3. **错误处理**：
   - 所有API调用都有错误处理
   - 失败时会显示错误提示
   - 网络错误会显示友好提示

---

**完成时间：** 2024年12月22日

