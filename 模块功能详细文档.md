# AI智能合同审核系统 - 模块功能详细文档

## 目录

1. [用户认证与权限管理模块](#1-用户认证与权限管理模块)
2. [合同管理模块](#2-合同管理模块)
3. [模板管理模块](#3-模板管理模块)
4. [合同审核模块](#4-合同审核模块)
5. [规则引擎模块](#5-规则引擎模块)
6. [知识图谱模块](#6-知识图谱模块)
7. [仪表盘模块](#7-仪表盘模块)
8. [AI功能模块详细说明](#14-ai功能模块详细说明)
   - [AI模型配置模块](#141-ai模型配置模块-)
   - [审核重点配置模块](#142-审核重点配置模块-)
   - [AI审核建议生成功能](#143-ai审核建议生成功能-)
   - [合同模板初始化功能](#144-合同模板初始化功能-)

---

## 1. 用户认证与权限管理模块

### 1.1 登录认证

**前端页面：** `frontend/src/views/Login.vue`

**功能描述：**
- 用户登录界面
- JWT Token认证
- 登录成功后自动获取用户信息
- 表单验证（用户名、密码必填）

**主要功能：**
- ✅ 用户名密码登录
- ✅ 登录状态持久化（Token存储在localStorage）
- ✅ 自动跳转到仪表盘
- ✅ 错误提示（登录失败时显示错误信息）

**API端点：**
- `POST /api/auth/login/` - 用户登录，返回access token和refresh token

**用户角色：**
- `admin` - 管理员（可访问所有功能）
- `reviewer` - 审核员（可进行合同审核）
- `drafter` - 起草人（可创建和编辑合同）

---

### 1.2 用户管理

**前端页面：** `frontend/src/views/users/UserList.vue`

**功能描述：**
- 完整的用户CRUD操作
- 仅管理员可见
- 支持用户搜索、过滤和分页

**主要功能：**

#### 1.2.1 用户列表
- ✅ 显示用户列表（用户名、邮箱、真实姓名、手机号、角色、部门、状态）
- ✅ 支持按用户名搜索
- ✅ 支持按角色过滤（管理员、审核员、起草人）
- ✅ 分页显示（10/20/50/100条每页）
- ✅ 状态标签显示（激活/禁用）

#### 1.2.2 创建用户
- ✅ 新建用户对话框
- ✅ 表单字段：
  - 用户名（必填，唯一）
  - 邮箱（必填，邮箱格式验证）
  - 密码（必填，创建时）
  - 真实姓名
  - 手机号
  - 部门（下拉选择）
  - 角色（必填，下拉选择：管理员/审核员/起草人）
  - 状态（开关：激活/禁用）

#### 1.2.3 编辑用户
- ✅ 编辑用户对话框
- ✅ 可修改所有字段
- ✅ 密码可选（留空则不修改）
- ✅ 用户名不可修改

#### 1.2.4 删除用户
- ✅ 删除确认对话框
- ✅ 软删除（后端标记is_deleted=True）

**API端点：**
- `GET /api/users/users/` - 获取用户列表（支持分页、搜索、过滤）
- `POST /api/users/users/` - 创建用户
- `GET /api/users/users/{id}/` - 获取用户详情
- `PATCH /api/users/users/{id}/` - 更新用户信息
- `DELETE /api/users/users/{id}/` - 删除用户
- `GET /api/users/users/me/` - 获取当前登录用户信息

**权限要求：** 仅管理员（`role === 'admin'`）

---

### 1.3 部门管理

**前端页面：** `frontend/src/views/users/DepartmentList.vue`

**功能描述：**
- 完整的部门CRUD操作
- 支持部门层级结构（父子部门）
- 仅管理员可见

**主要功能：**

#### 1.3.1 部门列表
- ✅ 显示部门列表（部门编码、部门名称、父部门、描述、创建时间）
- ✅ 支持按部门名称搜索
- ✅ 支持按部门编码搜索
- ✅ 分页显示
- ✅ 显示父部门名称

#### 1.3.2 创建部门
- ✅ 新建部门对话框
- ✅ 表单字段：
  - 部门名称（必填）
  - 部门编码（可选，如不填写将自动生成）
  - 父部门（可选，下拉选择，支持树形结构）
  - 部门描述

#### 1.3.3 编辑部门
- ✅ 编辑部门对话框
- ✅ 可修改所有字段
- ✅ 防止循环引用（不能选择自己作为父部门）

#### 1.3.4 删除部门
- ✅ 删除确认对话框
- ✅ 警告提示（删除后该部门下的用户将无法关联到此部门）

**API端点：**
- `GET /api/users/departments/` - 获取部门列表（支持分页、搜索）
- `POST /api/users/departments/` - 创建部门
- `GET /api/users/departments/{id}/` - 获取部门详情
- `PATCH /api/users/departments/{id}/` - 更新部门信息
- `DELETE /api/users/departments/{id}/` - 删除部门

**权限要求：** 仅管理员（`role === 'admin'`）

**数据结构：**
- 支持父子部门关系（parent字段）
- 部门编码唯一性约束

---

## 2. 合同管理模块

### 2.1 合同列表

**前端页面：** `frontend/src/views/contracts/ContractList.vue`

**功能描述：**
- 合同列表展示和管理
- 支持搜索、过滤和分页

**主要功能：**

#### 2.1.1 合同列表
- ✅ 显示合同列表（合同编号、标题、类型、状态、起草人、创建时间）
- ✅ 支持按合同类型过滤（采购合同、销售合同、劳动合同、服务合同）
- ✅ 支持按状态过滤（草稿、审核中、已审核、已批准、已拒绝、已签署）
- ✅ 分页显示
- ✅ 状态标签显示（不同状态不同颜色）

#### 2.1.2 合同操作
- ✅ 查看合同详情
- ✅ 编辑合同（跳转到详情页编辑模式）
- ✅ 提交审核（跳转到审核页面）
- ✅ 删除合同（确认对话框）

**API端点：**
- `GET /api/contracts/contracts/` - 获取合同列表（支持分页、搜索、过滤）
- `DELETE /api/contracts/contracts/{id}/` - 删除合同

**合同类型：**
- `procurement` - 采购合同
- `sales` - 销售合同
- `labor` - 劳动合同
- `service` - 服务合同

**合同状态：**
- `draft` - 草稿
- `reviewing` - 审核中
- `reviewed` - 已审核
- `approved` - 已批准
- `rejected` - 已拒绝
- `signed` - 已签署

---

### 2.2 创建合同

**前端页面：** `frontend/src/views/contracts/ContractCreate.vue`

**功能描述：**
- 创建新合同
- 支持使用模板创建
- 支持文件上传和自动解析
- **支持AI智能生成合同内容** ✅

**主要功能：**
- ✅ 合同基本信息填写
- ✅ 合同内容编辑（JSON格式）
- ✅ **AI智能生成合同内容** ✅
  - 填写基本信息（甲方、乙方、标的物、金额、交付方式、付款方式等）
  - 点击"AI生成合同内容"按钮，系统自动生成详细的合同内容
  - 支持基于模板生成或完全AI生成
  - 生成的内容可直接使用，也可在此基础上编辑
  - 当AI不可用时，自动使用模板生成模拟内容
- ✅ **文件上传功能（Word、PDF）** ✅
  - 支持上传Word (.doc, .docx) 和 PDF (.pdf) 文件
  - 文件大小限制10MB
  - 上传成功后自动解析文件内容
  - 解析内容自动填充到合同内容字段
  - 自动提取文档标题
- ✅ 可选择使用模板
- ✅ 表单验证

**AI生成功能：**
- **基本信息填写对话框**：包含甲方、乙方、标的物、金额、交付地点、交付时间、付款方式、付款时间等字段
- **AI生成按钮**：点击后调用后端API，生成详细的合同内容
- **生成状态提示**：显示生成进度和结果
- **内容自动填充**：生成成功后自动填充到合同内容框

**API端点：**
- `POST /api/contracts/contracts/` - 创建合同
- `POST /api/contracts/contracts/generate_content/` - AI生成合同内容 ✅
- `POST /api/contracts/upload/` - 上传并解析文件 ✅
- `GET /api/contracts/templates/` - 获取模板列表（用于选择模板）

**AI生成API：**
- 请求参数：
  - `contract_type`: 合同类型（必填）
  - `industry`: 所属行业（可选）
  - `template_id`: 模板ID（可选）
  - `basic_info`: 基本信息字典（包含party_a、party_b、subject、amount等）
- 响应格式：
  ```json
  {
    "success": true,
    "content": {
      "text": "生成的合同内容文本",
      "html": "HTML格式内容（可选）",
      "source": "template" 或 "generated"
    },
    "message": "合同内容生成成功"
  }
  ```

**文件上传API：**
- 请求格式：`multipart/form-data`
- 支持格式：`.doc`, `.docx`, `.pdf`
- 响应：返回文件路径和解析后的内容（文本、HTML格式）

---

### 2.3 合同详情

**前端页面：** `frontend/src/views/contracts/ContractDetail.vue`

**功能描述：**
- 查看合同详细信息
- 编辑合同信息
- 版本管理

**主要功能：**

#### 2.3.1 合同信息展示
- ✅ 合同基本信息（编号、标题、类型、行业、状态、版本、起草人、创建时间）
- ✅ 合同内容预览（JSON格式，格式化显示）
- ✅ 版本历史时间线展示

#### 2.3.2 合同编辑
- ✅ 编辑模式切换
- ✅ 可编辑字段：
  - 合同标题
  - 合同类型
  - 所属行业
  - 状态
  - 合同内容（JSON格式或富文本）
- ✅ **富文本编辑器（Quill）** ✅
  - 集成Quill富文本编辑器
  - 支持JSON和富文本两种编辑模式
  - 富文本内容保存为HTML格式
  - 模式切换功能
- ✅ JSON格式验证
- ✅ 保存更新

#### 2.3.3 合同操作
- ✅ 提交审核（创建审核任务）
- ✅ 创建新版本（版本号自动递增）

**API端点：**
- `GET /api/contracts/contracts/{id}/` - 获取合同详情
- `PATCH /api/contracts/contracts/{id}/` - 更新合同信息
- `POST /api/contracts/contracts/{id}/create_version/` - 创建新版本
- `GET /api/contracts/contracts/{id}/versions/` - 获取版本历史

**版本管理：**
- 每次创建新版本，版本号自动递增
- 记录变更摘要和变更人
- 保留历史版本内容

---

## 3. 模板管理模块

### 3.1 模板列表

**前端页面：** `frontend/src/views/templates/TemplateList.vue`

**功能描述：**
- 合同模板库管理
- 完整的模板CRUD操作
- **系统内置详细模板** ✅

**主要功能：**

#### 3.1.1 模板列表
- ✅ 显示模板列表（模板名称、合同类型、适用行业、分类、使用次数、是否公开、创建时间）
- ✅ 支持按合同类型过滤
- ✅ 支持按是否公开过滤
- ✅ 分页显示
- ✅ 公开/私有标签显示

#### 3.1.2 模板操作
- ✅ 使用模板（跳转到创建合同页面，预填充模板内容）
- ✅ 编辑模板（对话框表单）
- ✅ 删除模板（确认对话框）

#### 3.1.3 创建模板
- ✅ 新建模板对话框
- ✅ 表单字段：
  - 模板名称（必填）
  - 合同类型（必填）
  - 适用行业
  - 模板分类
  - 模板内容（必填，文本域）
  - 模板描述
  - 标签（逗号分隔）
  - 是否公开（开关）
  - 是否企业模板（开关）

#### 3.1.4 编辑模板
- ✅ 编辑模板对话框
- ✅ 可修改所有字段
- ✅ 标签处理（逗号分隔转换为数组）

#### 3.1.5 系统内置模板 ✅
系统提供了4个详细的合同模板：
- **采购合同模板（详细版）** - 包含10条详细条款，适用于制造业
- **销售合同模板（详细版）** - 包含9条详细条款，适用于贸易行业
- **服务合同模板（详细版）** - 包含10条详细条款，适用于IT行业
- **劳动合同模板（详细版）** - 包含11条详细条款，符合劳动法规定

**模板特点：**
- 完整的合同结构（合同双方信息、合同条款、签字盖章等）
- 详细的条款说明（每条都有子条款）
- 具体的占位符（便于填写具体信息）
- 多种选择项（用□标记）
- 完整的违约责任、争议解决等条款
- 符合法律法规的表述

**初始化模板：**
运行管理命令初始化模板数据：
```bash
python manage.py init_templates
```

**API端点：**
- `GET /api/contracts/templates/` - 获取模板列表（支持分页、搜索、过滤）
- `POST /api/contracts/templates/` - 创建模板
- `GET /api/contracts/templates/{id}/` - 获取模板详情
- `PATCH /api/contracts/templates/{id}/` - 更新模板信息
- `DELETE /api/contracts/templates/{id}/` - 删除模板
- `POST /api/contracts/templates/{id}/use/` - 使用模板（增加使用次数）

**模板属性：**
- `is_public` - 是否公开（公开模板所有用户可见）
- `is_enterprise` - 是否企业模板
- `usage_count` - 使用次数（自动统计）

---

## 4. 合同审核模块

### 4.1 审核任务列表

**前端页面：** `frontend/src/views/reviews/ReviewList.vue`

**功能描述：**
- 审核任务管理
- 完整的审核任务CRUD操作

**主要功能：**

#### 4.1.1 审核任务列表
- ✅ 显示审核任务列表（合同标题、任务类型、状态、优先级、创建人、创建时间）
- ✅ 支持按任务类型过滤（自动审核、人工审核）
- ✅ 支持按状态过滤（待处理、处理中、已完成、失败）
- ✅ 分页显示
- ✅ 状态标签显示（不同状态不同颜色）

#### 4.1.2 审核任务操作
- ✅ 查看审核详情
- ✅ 启动审核任务（仅待处理状态可启动）
- ✅ 编辑审核任务（仅待处理状态可编辑）
- ✅ 删除审核任务（确认对话框）

#### 4.1.3 创建审核任务
- ✅ 新建审核任务对话框
- ✅ 表单字段：
  - 合同（必填，下拉选择）
  - 任务类型（必填：自动审核/人工审核）
  - 优先级（必填：高/中/低）

#### 4.1.4 编辑审核任务
- ✅ 编辑审核任务对话框（仅待处理状态）
- ✅ 可修改任务类型和优先级

**API端点：**
- `GET /api/reviews/tasks/` - 获取审核任务列表（支持分页、搜索、过滤）
- `POST /api/reviews/tasks/` - 创建审核任务
- `GET /api/reviews/tasks/{id}/` - 获取审核任务详情
- `PATCH /api/reviews/tasks/{id}/` - 更新审核任务
- `DELETE /api/reviews/tasks/{id}/` - 删除审核任务
- `POST /api/reviews/tasks/{id}/start/` - 启动审核任务（触发Celery异步任务）

**任务状态：**
- `pending` - 待处理
- `processing` - 处理中
- `completed` - 已完成
- `failed` - 失败

**任务类型：**
- `auto` - 自动审核（使用规则引擎和AI模型，完整的质检中心流程）✅
- `manual` - 人工审核（多级人工审核，支持AI辅助建议）✅

**自动审核流程（质检中心）** ✅：
1. **规则引擎扫描** - 使用规则引擎扫描合同，匹配通用/行业/企业规则
2. **大模型语义理解** - 使用AI进行语义分析和理解
3. **条款识别** - 识别关键条款（主体、标的、期限、责任、付款、违约责任、争议解决）
4. **风险识别** - 多维度风险识别（合法性、合规性、完整性、财务风险）
5. **风险量化分级** - 计算风险分数和风险等级（高/中/低）
6. **逐条扫描对比评分** - 逐条扫描合同条款，与规则库对比评分
7. **输出修改建议** - 生成可执行的修改建议
8. **生成审核报告** - 生成包含合同信息、风险概览、修改建议、法律依据的审核报告

**人工审核流程（多级审核）** ✅：
1. **分配审核任务** - 根据审核员层级分配任务
2. **一级审核员审核** - 重点：格式规范、基础条款完整性、基本信息准确性
   - AI生成审核建议（基于审核重点配置）
3. **二级审核员审核** - 重点：法律合规性、风险识别、条款合理性、权利义务平衡
   - AI生成审核建议（基于审核重点配置）
4. **三级审核员审核** - 重点：重大风险、战略层面、商业决策、最终批准
   - AI生成审核建议（基于审核重点配置）
5. **审核意见闭环** - 自动汇总各层级审核意见，反馈给起草人

**优先级：**
- `high` - 高
- `medium` - 中
- `low` - 低

---

### 4.2 审核详情

**前端页面：** `frontend/src/views/reviews/ReviewDetail.vue`

**功能描述：**
- 查看审核结果详情
- 审核意见展示
- **审核意见闭环管理** ✅

**主要功能：**
- ✅ 审核任务基本信息
- ✅ 审核结果展示（总体评分、风险等级、风险数量、摘要）
- ✅ 审核意见列表（条款、意见类型、风险等级、意见内容、法律依据、建议）
- ✅ **审核报告下载** ✅
  - 支持下载审核报告文件
  - 自动设置正确的Content-Type
  - 设置下载文件名
- ✅ **审核报告预览** ✅
  - 支持预览审核报告（浏览器内联显示）
  - PDF文件：浏览器内联显示
  - Word文件：尝试内联显示
  - 其他格式：文本预览
- ✅ **审核意见闭环功能** ✅
  - **汇总审核意见**：自动汇总各层级审核意见（一级/二级/三级）
  - **意见汇总表展示**：
    - 按层级分组显示审核意见
    - 显示统计信息（总意见数、高风险/中风险/低风险数量）
    - 支持切换查看不同层级的意见
    - 表格展示意见详情（类型、风险等级、内容、建议等）
  - **反馈给起草人**：将审核意见反馈给合同起草人
  - **重新提交审核**：起草人修改合同后重新提交审核

**审核意见闭环流程：**
1. 点击"汇总审核意见"按钮，系统自动汇总所有相关审核任务的审核意见
2. 查看汇总表，按层级分组查看意见
3. 点击"反馈给起草人"按钮，将意见反馈给起草人，合同状态更新为"待修改"
4. 起草人根据意见修改合同
5. 点击"重新提交审核"按钮，系统创建新版本和新的审核任务

**API端点：**
- `GET /api/reviews/tasks/{id}/` - 获取审核任务详情（包含审核结果）
- `GET /api/reviews/results/{id}/download_report/` - 下载审核报告 ✅
- `GET /api/reviews/results/{id}/preview_report/` - 预览审核报告 ✅
- `POST /api/reviews/cycles/summarize_opinions/` - 汇总审核意见 ✅
- `POST /api/reviews/cycles/feedback_to_drafter/` - 反馈给起草人 ✅
- `POST /api/reviews/cycles/resubmit_for_review/` - 重新提交审核 ✅

**审核结果字段：**
- `overall_score` - 总体评分（0-100）
- `risk_level` - 风险等级（high/medium/low）
- `risk_count` - 风险数量
- `summary` - 审核摘要
- `report_path` - 报告文件路径

**审核意见字段：**
- `clause_id` - 条款ID
- `clause_content` - 条款内容
- `opinion_type` - 意见类型
- `risk_level` - 风险等级
- `opinion_content` - 意见内容
- `legal_basis` - 法律依据
- `suggestion` - 建议

---

## 5. 规则引擎模块

### 5.1 规则列表

**前端页面：** `frontend/src/views/rules/RuleList.vue`

**功能描述：**
- 审核规则管理
- 完整的规则CRUD操作

**主要功能：**

#### 5.1.1 规则列表
- ✅ 显示规则列表（规则编码、规则名称、规则类型、适用行业、分类、风险等级、状态、创建时间）
- ✅ 支持按规则类型过滤（通用规则、行业规则、企业规则）
- ✅ 支持按风险等级过滤（高风险、中风险、低风险）
- ✅ 支持按状态过滤（启用、禁用）
- ✅ 分页显示
- ✅ 风险等级标签显示（不同等级不同颜色）
- ✅ 状态标签显示（启用/禁用）

#### 5.1.2 规则操作
- ✅ 编辑规则（对话框表单）
- ✅ 删除规则（确认对话框）

#### 5.1.3 创建规则
- ✅ 新建规则对话框
- ✅ 表单字段：
  - 规则编码（必填，唯一）
  - 规则名称（必填）
  - 规则类型（必填：通用规则/行业规则/企业规则）
  - 适用行业
  - 规则分类
  - 优先级（数字，0-100）
  - 风险等级（下拉选择：高风险/中风险/低风险）
  - 规则内容（必填，JSON格式，文本域）
  - 法律依据（文本域）
  - 规则描述（文本域）
  - 是否启用（开关）

#### 5.1.4 编辑规则
- ✅ 编辑规则对话框
- ✅ 可修改所有字段
- ✅ JSON格式验证（规则内容必须是有效的JSON）

**API端点：**
- `GET /api/rules/rules/` - 获取规则列表（支持分页、搜索、过滤）
- `POST /api/rules/rules/` - 创建规则
- `GET /api/rules/rules/{id}/` - 获取规则详情
- `PATCH /api/rules/rules/{id}/` - 更新规则信息
- `DELETE /api/rules/rules/{id}/` - 删除规则

**规则类型：**
- `general` - 通用规则（适用于所有合同）
- `industry` - 行业规则（适用于特定行业）
- `enterprise` - 企业规则（适用于特定企业）

**风险等级：**
- `high` - 高风险
- `medium` - 中风险
- `low` - 低风险

**规则内容格式：**
规则内容为JSON格式，包含规则的类型、模式、条件和动作，例如：
```json
{
  "type": "keyword",  // keyword/regex/pattern
  "patterns": ["关键词1", "关键词2"],
  "conditions": {},
  "action": "warning"  // warning/error/suggestion
}
```

**规则引擎功能** ✅：
- ✅ **规则扫描** - 自动扫描合同内容，匹配适用的规则
- ✅ **规则匹配** - 支持关键词匹配、正则表达式匹配、模式匹配
- ✅ **匹配记录** - 保存规则匹配记录到数据库
- ✅ **评分计算** - 根据匹配结果计算总体评分和风险等级
- ✅ **规则分类** - 支持通用规则、行业规则、企业规则
- ✅ **优先级排序** - 按规则优先级进行匹配

**规则匹配API：**
- 通过 `RuleEngineService.scan_contract()` 方法调用
- 自动在审核任务处理过程中执行
- 返回匹配结果、评分、风险等级等信息

---

## 6. 知识图谱模块

### 6.1 知识图谱页面

**前端页面：** `frontend/src/views/knowledge/KnowledgeGraph.vue`

**功能描述：**
- 知识图谱展示和管理
- 实体和关系管理

**主要功能：**
- ✅ 知识实体列表展示
- ✅ 法律法规库展示
- ✅ 案例库展示
- ✅ **知识图谱可视化** ✅
  - 使用ECharts力导向图（Graph）展示实体和关系
  - 支持节点交互、缩放、拖拽
  - 支持图谱刷新功能
  - 节点按类型分组，不同颜色显示
  - 关系线显示关系类型
  - 力导向布局算法自动排列节点

**API端点：**
- `GET /api/knowledge/entities/` - 获取知识实体列表
- `GET /api/knowledge/relations/` - 获取知识关系列表 ✅
  - 返回源实体和目标实体的ID和名称
  - 支持过滤和排序
- `GET /api/knowledge/regulations/` - 获取法律法规列表
- `GET /api/knowledge/cases/` - 获取案例列表

**数据结构：**
- 知识实体（实体名称、类型、描述）
- 实体关系（关系类型、源实体、目标实体）
- 法律法规（法规名称、发布机构、生效日期、内容）
- 案例（案例名称、案例类型、案例描述、判决结果）

---

## 7. 仪表盘模块

### 7.1 仪表盘

**前端页面：** `frontend/src/views/Dashboard.vue`

**功能描述：**
- 系统概览和统计信息
- 数据可视化展示

**主要功能：**
- ✅ 统计数据展示（合同总数、待审核任务、已完成审核、风险合同数等）
- ✅ **数据可视化图表** ✅
  - **合同状态分布饼图**：展示不同状态合同的数量分布
  - **审核任务状态分布饼图**：展示审核任务的状态分布
  - **合同类型分布环形图**：展示不同类型合同的数量分布
  - **月度合同趋势折线图**：展示最近6个月的合同创建趋势
  - 使用ECharts实现，响应式数据绑定，自动更新
- ✅ 最近合同列表
- ✅ 最近审核任务列表

**技术实现：**
- 使用 `echarts` 和 `vue-echarts` 实现图表
- 数据从后端API实时获取
- 图表支持交互和缩放

---

## 8. 系统架构与特性

### 8.1 前端架构

**技术栈：**
- Vue 3 (Composition API)
- Element Plus (UI组件库)
- Vue Router (路由管理)
- Pinia (状态管理)
- Axios (HTTP客户端)
- Vite (构建工具)

**项目结构：**
```
frontend/src/
├── views/          # 页面组件
│   ├── Login.vue   # 登录页
│   ├── Dashboard.vue # 仪表盘
│   ├── contracts/  # 合同管理页面
│   ├── templates/  # 模板管理页面
│   ├── reviews/    # 审核管理页面
│   ├── rules/      # 规则管理页面
│   ├── knowledge/  # 知识图谱页面
│   └── users/      # 用户管理页面
├── layouts/        # 布局组件
│   └── MainLayout.vue
├── stores/         # Pinia状态管理
│   └── user.js
├── router/         # 路由配置
│   └── index.js
└── utils/          # 工具函数
    └── api.js      # API请求封装
```

**主要特性：**
- ✅ 响应式设计
- ✅ 路由守卫（认证保护）
- ✅ 自动获取用户信息
- ✅ 统一的错误处理
- ✅ 统一的API请求封装
- ✅ 表单验证
- ✅ 分页支持
- ✅ 搜索和过滤
- ✅ **路由懒加载** ✅
  - 所有路由组件使用动态导入
  - 按需加载，提升首屏加载速度
  - 代码分割优化
- ✅ **数据可视化** ✅
  - 集成ECharts图表库
  - 支持多种图表类型
- ✅ **富文本编辑** ✅
  - 集成Quill富文本编辑器
  - 支持HTML格式内容编辑

---

### 8.2 后端架构

**技术栈：**
- Django 4.2.7
- Django REST Framework
- Celery (异步任务)
- MySQL 8.0
- JWT认证 (djangorestframework-simplejwt)
- django-filter (过滤)

**项目结构：**
```
backend/
├── apps/           # 应用模块
│   ├── users/      # 用户管理
│   ├── contracts/  # 合同管理
│   ├── reviews/    # 合同审核
│   ├── rules/      # 规则引擎
│   ├── clauses/    # 条款识别
│   ├── risks/      # 风险识别
│   ├── comparisons/# 对比分析
│   ├── knowledge/  # 知识图谱
│   └── recommendations/ # 智能推荐
├── config/         # 项目配置
│   ├── settings.py
│   ├── urls.py
│   └── celery.py
└── manage.py
```

**主要特性：**
- ✅ RESTful API设计
- ✅ JWT认证
- ✅ 软删除机制
- ✅ 审计日志
- ✅ 分页支持
- ✅ 搜索和过滤
- ✅ Celery异步任务
- ✅ CORS支持
- ✅ **文件上传和解析** ✅
  - 支持Word和PDF文件上传
  - 自动解析文件内容
  - 文件存储管理
- ✅ **文件下载和预览** ✅
  - 支持文件下载
  - 支持文件预览（浏览器内联显示）

---

### 8.3 权限控制

**角色定义：**
- **管理员 (admin)**：可访问所有功能，包括用户管理、部门管理
- **审核员 (reviewer)**：可进行合同审核、查看审核结果
- **起草人 (drafter)**：可创建和编辑合同、使用模板

**权限实现：**
- 前端：使用 `v-if` 条件渲染，根据用户角色显示/隐藏菜单和功能
- 后端：使用 `permission_classes` 进行API权限控制

---

### 8.4 数据安全

**安全措施：**
- ✅ JWT Token认证
- ✅ 密码加密存储（Django默认使用PBKDF2）
- ✅ 软删除机制（数据不真正删除）
- ✅ 审计日志记录
- ✅ CORS配置
- ✅ SQL注入防护（Django ORM）
- ✅ XSS防护（前端输入验证）

---

## 9. API端点汇总

### 9.1 认证API
- `POST /api/auth/login/` - 用户登录
- `POST /api/auth/refresh/` - 刷新Token

### 9.2 用户管理API
- `GET /api/users/users/` - 用户列表
- `POST /api/users/users/` - 创建用户
- `GET /api/users/users/{id}/` - 用户详情
- `PATCH /api/users/users/{id}/` - 更新用户
- `DELETE /api/users/users/{id}/` - 删除用户
- `GET /api/users/users/me/` - 当前用户信息

### 9.3 部门管理API
- `GET /api/users/departments/` - 部门列表
- `POST /api/users/departments/` - 创建部门
- `GET /api/users/departments/{id}/` - 部门详情
- `PATCH /api/users/departments/{id}/` - 更新部门
- `DELETE /api/users/departments/{id}/` - 删除部门

### 9.4 合同管理API
- `GET /api/contracts/contracts/` - 合同列表
- `POST /api/contracts/contracts/` - 创建合同
- `GET /api/contracts/contracts/{id}/` - 合同详情
- `PATCH /api/contracts/contracts/{id}/` - 更新合同
- `DELETE /api/contracts/contracts/{id}/` - 删除合同
- `POST /api/contracts/contracts/{id}/create_version/` - 创建版本

### 9.5 模板管理API
- `GET /api/contracts/templates/` - 模板列表
- `POST /api/contracts/templates/` - 创建模板
- `GET /api/contracts/templates/{id}/` - 模板详情
- `PATCH /api/contracts/templates/{id}/` - 更新模板
- `DELETE /api/contracts/templates/{id}/` - 删除模板
- `POST /api/contracts/templates/{id}/use/` - 使用模板

### 9.6 审核任务API
- `GET /api/reviews/tasks/` - 审核任务列表
- `POST /api/reviews/tasks/` - 创建审核任务
- `GET /api/reviews/tasks/{id}/` - 审核任务详情
- `PATCH /api/reviews/tasks/{id}/` - 更新审核任务
- `DELETE /api/reviews/tasks/{id}/` - 删除审核任务
- `POST /api/reviews/tasks/{id}/start/` - 启动审核任务

### 9.7 规则引擎API
- `GET /api/rules/rules/` - 规则列表
- `POST /api/rules/rules/` - 创建规则
- `GET /api/rules/rules/{id}/` - 规则详情
- `PATCH /api/rules/rules/{id}/` - 更新规则
- `DELETE /api/rules/rules/{id}/` - 删除规则

### 9.8 文件上传API ✅
- `POST /api/contracts/upload/` - 上传并解析文件（Word、PDF）
  - 请求格式：`multipart/form-data`
  - 支持格式：`.doc`, `.docx`, `.pdf`
  - 文件大小限制：10MB
  - 响应：返回文件路径和解析后的内容

### 9.9 审核报告API ✅
- `GET /api/reviews/results/{id}/download_report/` - 下载审核报告
  - 响应：文件流（FileResponse）
  - 自动设置Content-Type和下载文件名
- `GET /api/reviews/results/{id}/preview_report/` - 预览审核报告
  - 响应：文件流（内联显示）
  - 支持PDF和Word格式

### 9.10 知识图谱关系API ✅
- `GET /api/knowledge/relations/` - 获取知识关系列表
  - 返回源实体和目标实体的ID和名称
  - 支持过滤和排序
- `POST /api/knowledge/relations/` - 创建关系
- `GET /api/knowledge/relations/{id}/` - 获取关系详情
- `PATCH /api/knowledge/relations/{id}/` - 更新关系
- `DELETE /api/knowledge/relations/{id}/` - 删除关系

---

## 10. 使用说明

### 10.1 登录系统
1. 访问登录页面
2. 输入用户名和密码
3. 点击登录按钮
4. 系统自动跳转到仪表盘

### 10.2 创建合同
1. 进入"合同管理"菜单
2. 点击"新建合同"按钮
3. 填写合同信息
4. 可选择使用模板
5. **可选：上传文件（Word或PDF），系统会自动解析内容**
6. 编辑合同内容（JSON格式）
7. 保存合同

### 10.3 提交审核
1. 在合同列表或详情页点击"审核"按钮
2. 或进入"合同审核"菜单，点击"新建审核任务"
3. 选择合同、任务类型和优先级
4. 创建审核任务
5. 点击"启动"按钮开始审核
6. **查看审核结果后，可以下载或预览审核报告**

### 10.4 管理用户（管理员）
1. 进入"用户管理"菜单
2. 可以创建、编辑、删除用户
3. 可以设置用户角色和部门

### 10.5 管理部门（管理员）
1. 进入"部门管理"菜单
2. 可以创建、编辑、删除部门
3. 可以设置部门层级关系

---

## 11. 已完善功能

### 11.1 前端功能 ✅
- ✅ 知识图谱可视化（使用ECharts）
  - 实现了知识图谱的力导向图可视化
  - 支持节点和关系的交互展示
  - 支持图谱刷新和缩放
- ✅ 仪表盘数据图表
  - 合同状态分布饼图
  - 审核任务状态分布饼图
  - 合同类型分布环形图
  - 月度合同趋势折线图
- ✅ 文件上传功能（Word、PDF）
  - 支持上传Word (.doc, .docx) 和 PDF (.pdf) 文件
  - 文件大小限制10MB
  - 上传成功后自动解析内容
- ✅ 审核报告预览和下载
  - 支持审核报告下载
  - 支持审核报告预览（新窗口打开）
- ✅ 合同内容富文本编辑器
  - 集成Quill富文本编辑器
  - 支持JSON和富文本两种编辑模式切换
  - 富文本内容保存为HTML格式
- ✅ 路由懒加载优化
  - 所有路由组件使用动态导入
  - 按需加载，提升首屏加载速度
  - 代码分割优化

### 11.2 后端功能 ✅

#### 11.2.1 已实现的后端功能
- ✅ **文件上传和解析API** ✅
  - 支持Word文档（.doc, .docx）和PDF文件上传
  - 自动解析文件内容（文本和HTML格式）
  - 文件大小限制10MB
  - 文件类型验证
  - 使用 `python-docx` 和 `pymupdf` 解析文件
- ✅ **审核报告下载和预览API** ✅
  - 支持下载审核报告文件
  - 支持预览审核报告（浏览器内联显示）
  - 自动设置正确的Content-Type
  - 支持PDF和Word格式
- ✅ **知识图谱关系API优化** ✅
  - 优化序列化器，添加 `source_entity_id` 和 `target_entity_id` 字段
  - 便于前端知识图谱可视化使用

#### 11.2.2 待实现的后端功能
- [ ] 集成大模型API（OpenAI、文心一言等）
- [ ] 审核报告自动生成（Word/PDF格式）
- [ ] 条款识别AI模型集成
- [ ] 风险识别AI模型集成
- [ ] 智能推荐算法实现

### 11.3 系统优化

#### 11.3.1 已完成的优化
- ✅ **前端代码分割和懒加载** ✅
  - 所有路由组件使用动态导入
  - 按需加载，提升首屏加载速度
  - 代码分割优化

#### 11.3.2 待完成的优化
- [ ] 添加缓存机制（Redis）
- [ ] 数据库查询优化
- [ ] 单元测试和集成测试
- [ ] 性能监控和日志分析

---

## 12. 技术文档

### 12.1 开发环境要求
- Python 3.9+
- Node.js 16+
- MySQL 8.0+
- Redis 6.0+

### 12.2 安装步骤
详见 `README.md` 和 `项目说明.md`

### 12.3 数据库设计
详见 `数据库设计文档.md`

---

## 13. 总结

本系统已实现以下核心功能：

✅ **用户认证与权限管理**
- 登录认证
- 用户管理（CRUD）
- 部门管理（CRUD）
- 角色权限控制
- 审核员层级管理

✅ **合同管理**
- 合同列表、创建、编辑、删除
- 合同详情查看
- 版本管理
- 搜索和过滤
- **AI智能生成合同内容** ✅
- **文件上传和解析** ✅

✅ **模板管理**
- 模板列表、创建、编辑、删除
- 使用模板创建合同
- 模板分类和标签
- **系统内置详细模板** ✅

✅ **合同审核**
- 审核任务管理（CRUD）
- 启动审核任务
- 审核结果查看
- 审核意见展示
- **自动审核流程（质检中心）** ✅
- **多级人工审核** ✅
- **审核意见闭环** ✅
- **AI审核建议生成** ✅

✅ **规则引擎**
- 规则管理（CRUD）
- 规则类型和风险等级
- JSON格式规则内容
- **规则扫描和匹配算法** ✅
- **规则匹配记录** ✅
- **评分和风险等级计算** ✅

✅ **知识图谱**
- 知识实体管理
- 法律法规库
- 案例库
- 知识图谱可视化（ECharts力导向图）

✅ **AI功能**
- **AI模型配置管理** ✅
- **审核重点配置管理** ✅
- **AI审核建议生成** ✅
- **AI合同内容生成** ✅
- 支持多种AI服务提供商（硅基流动、OpenAI、Anthropic等）

✅ **数据可视化**
- 仪表盘数据图表（饼图、环形图、折线图）
- 知识图谱可视化
- 实时数据更新

✅ **文件处理**
- 文件上传（Word、PDF）
- 文件内容自动解析
- 审核报告下载和预览

✅ **富文本编辑**
- Quill富文本编辑器
- JSON/富文本模式切换
- HTML格式内容保存

✅ **性能优化**
- 路由懒加载
- 代码分割
- 按需加载

✅ **系统特性**
- 响应式设计
- 权限控制
- 数据安全
- 异步任务支持（Celery）

所有功能均已在Vue前端实现完整的增删改查操作，提供了良好的用户体验和完整的业务功能。系统支持完整的合同起草、审核、意见闭环流程，并集成了AI功能提供智能辅助。

---

## 14. AI功能模块详细说明

### 14.1 AI模型配置模块 ✅

**前端页面：** `frontend/src/views/reviews/AIModelConfig.vue`

**功能描述：**
- AI大模型配置管理
- 支持多种AI服务提供商
- 仅管理员可见

**主要功能：**
- ✅ **AI模型配置列表**
  - 显示配置列表（配置名称、服务提供商、默认模型、状态、创建时间）
  - 支持按服务提供商过滤
  - 支持按状态过滤（启用/禁用）
  - 分页显示
  - 状态标签显示
- ✅ **创建AI模型配置**
  - 配置名称（必填，唯一）
  - 服务提供商（必填：硅基流动/OpenAI/Anthropic/自定义）
  - API密钥（必填）
  - API基础地址（默认：硅基流动API地址）
  - 可用模型列表（JSON格式）
  - 默认模型（从可用模型列表中选择）
  - 温度参数（0-2，默认0.7）
  - 最大Token数（默认2000）
  - 超时时间（秒，默认30）
  - 是否启用（开关）
  - 是否系统默认（开关，只能有一个配置为系统默认）
  - 配置描述
- ✅ **编辑AI模型配置**
  - 可修改所有字段
  - 验证默认模型是否在可用模型列表中
- ✅ **API连接测试**
  - 测试API连接是否正常
  - 验证API密钥是否有效
- ✅ **获取可用模型列表**
  - 从AI服务提供商获取可用模型列表
  - 自动更新可用模型列表
- ✅ **设置默认配置**
  - 设置某个配置为系统默认配置
  - 自动取消其他配置的默认状态

**API端点：**
- `GET /api/reviews/ai-model-configs/` - 获取配置列表
- `POST /api/reviews/ai-model-configs/` - 创建配置
- `GET /api/reviews/ai-model-configs/{id}/` - 获取配置详情
- `PATCH /api/reviews/ai-model-configs/{id}/` - 更新配置
- `DELETE /api/reviews/ai-model-configs/{id}/` - 删除配置
- `GET /api/reviews/ai-model-configs/get_default/` - 获取系统默认配置
- `POST /api/reviews/ai-model-configs/{id}/set_default/` - 设置为系统默认
- `POST /api/reviews/ai-model-configs/{id}/test_connection/` - 测试API连接
- `POST /api/reviews/ai-model-configs/{id}/get_available_models/` - 获取可用模型列表

**支持的服务提供商：**
- `siliconflow` - 硅基流动（默认）
- `openai` - OpenAI
- `anthropic` - Anthropic
- `custom` - 自定义

---

### 14.2 审核重点配置模块 ✅

**前端页面：** `frontend/src/views/reviews/ReviewFocusConfig.vue`

**功能描述：**
- 审核重点配置管理
- 为不同层级的审核员配置审核重点
- 仅管理员可见

**主要功能：**
- ✅ **审核重点配置列表**
  - 显示配置列表（审核层级、层级名称、审核重点、描述、创建时间）
  - 支持按审核层级过滤
  - 分页显示
- ✅ **创建审核重点配置**
  - 审核层级（必填：一级审核员/二级审核员/三级审核员，唯一）
  - 层级名称（必填）
  - 审核重点（JSON格式，包含重点列表）
  - 审核重点描述（文本域）
  - 审核标准（文本域，可选）
  - 关注事项（JSON格式，可选）
  - 是否启用（开关）
- ✅ **编辑审核重点配置**
  - 可修改所有字段
  - JSON格式验证

**API端点：**
- `GET /api/reviews/focus-configs/` - 获取配置列表
- `POST /api/reviews/focus-configs/` - 创建配置
- `GET /api/reviews/focus-configs/{id}/` - 获取配置详情
- `PATCH /api/reviews/focus-configs/{id}/` - 更新配置
- `DELETE /api/reviews/focus-configs/{id}/` - 删除配置

**审核层级：**
- `level1` - 一级审核员（重点：格式规范、基础条款完整性、基本信息准确性）
- `level2` - 二级审核员（重点：法律合规性、风险识别、条款合理性、权利义务平衡）
- `level3` - 三级审核员（重点：重大风险、战略层面、商业决策、最终批准）

---

### 14.3 AI审核建议生成功能 ✅

**功能描述：**
- 根据审核员层级和审核重点配置，生成AI审核建议
- 支持不同层级的针对性建议

**主要功能：**
- ✅ **AI审核建议生成**
  - 根据审核员层级自动获取对应的审核重点配置
  - 基于审核重点配置构建AI提示词
  - 调用AI服务生成审核建议
  - 自动保存AI建议到审核结果
- ✅ **审核建议内容**
  - 总体评价
  - 发现的问题（条款ID、条款内容、问题描述、风险等级、法律依据、建议）
  - 重点关注事项
  - 审核结论

**API端点：**
- `POST /api/reviews/ai-suggestions/generate/` - 生成AI审核建议
- `GET /api/reviews/ai-suggestions/` - 获取AI审核建议列表

**使用场景：**
1. 审核员在审核合同时，系统自动生成AI建议作为参考
2. 审核任务处理过程中，自动调用AI服务生成建议
3. 审核员可以采纳、修改或忽略AI建议

---

### 14.4 合同模板初始化功能 ✅

**功能描述：**
- 系统内置详细的合同模板
- 通过管理命令初始化模板数据

**内置模板：**
1. **采购合同模板（详细版）**
   - 包含10条详细条款
   - 适用于制造业
   - 包含完整的合同双方信息、标的、交付、付款、质量保证、违约责任等条款

2. **销售合同模板（详细版）**
   - 包含9条详细条款
   - 适用于贸易行业
   - 包含完整的销售合同条款

3. **服务合同模板（详细版）**
   - 包含10条详细条款
   - 适用于IT行业
   - 包含完整的服务合同条款

4. **劳动合同模板（详细版）**
   - 包含11条详细条款
   - 符合劳动法规定
   - 包含完整的劳动合同条款

**初始化命令：**
```bash
python manage.py init_templates
```

**模板特点：**
- 完整的合同结构
- 详细的条款说明（每条都有子条款）
- 具体的占位符（便于填写）
- 多种选择项（用□标记）
- 符合法律法规的表述

---

## 15. 新增功能详细说明

### 15.1 数据可视化功能

#### 仪表盘图表
- **合同状态分布饼图**：实时统计并展示不同状态合同的数量分布
- **审核任务状态分布饼图**：展示审核任务的状态分布情况
- **合同类型分布环形图**：展示不同类型合同的数量占比
- **月度合同趋势折线图**：展示最近6个月的合同创建趋势，支持平滑曲线和面积填充

**技术实现：**
- 使用ECharts 6.0+版本
- Vue 3 Composition API集成
- 响应式数据绑定，数据变化自动更新图表

#### 知识图谱可视化
- **力导向图布局**：自动计算节点位置，美观展示实体关系
- **节点交互**：支持拖拽、缩放、高亮
- **关系展示**：不同关系类型用不同颜色和样式展示
- **节点分组**：按实体类型分组，不同颜色标识

**技术实现：**
- 使用ECharts Graph图表类型
- 力导向布局算法
- 支持大量节点和关系的渲染

### 15.2 文件处理功能

#### 文件上传
- **支持格式**：Word (.doc, .docx) 和 PDF (.pdf)
- **文件大小**：最大10MB
- **自动解析**：上传后自动解析文件内容
- **内容提取**：
  - Word：提取所有段落文本
  - PDF：逐页提取文本
  - 生成纯文本和HTML两种格式

#### 文件解析技术
- **Word解析**：使用 `python-docx` 库
- **PDF解析**：使用 `pymupdf` (fitz) 库
- **错误处理**：完善的异常处理机制

### 15.3 审核报告功能

#### 报告下载
- 支持PDF和Word格式报告下载
- 自动设置正确的Content-Type
- 自动生成下载文件名

#### 报告预览
- PDF文件：浏览器内联显示
- Word文件：尝试内联显示（浏览器支持时）
- 其他格式：文本预览

### 15.4 富文本编辑器

#### Quill编辑器
- 功能丰富的富文本编辑
- 支持格式化、列表、链接等
- 内容保存为HTML格式

#### 编辑模式
- **JSON模式**：直接编辑JSON格式内容
- **富文本模式**：使用可视化编辑器编辑
- **模式切换**：可在两种模式间切换

### 15.5 性能优化

#### 路由懒加载
- 所有路由组件使用动态导入
- 按功能模块分割代码
- 减少首屏加载时间

#### 代码分割
- 使用webpackChunkName注释
- 相关路由打包到同一chunk
- 优化加载策略

---

## 16. 技术栈更新

### 16.1 前端新增依赖

```json
{
  "echarts": "^6.0.0",           // 图表库
  "vue-echarts": "^8.0.1",      // ECharts的Vue封装
  "@vueup/vue-quill": "^1.2.0", // Quill富文本编辑器的Vue封装
  "quill": "^2.0.3"              // 富文本编辑器核心
}
```

### 16.2 后端新增依赖

已在 `requirements.txt` 中包含：
```
python-docx==1.1.2  # Word文档处理
pymupdf==1.24.5     # PDF文档处理
```

### 16.3 安装命令

**前端：**
```bash
cd frontend
npm install echarts vue-echarts @vueup/vue-quill quill --save
```

**后端：**
```bash
cd backend
pip install python-docx pymupdf
```

---

## 17. API使用示例

### 16.1 文件上传

**前端代码：**
```javascript
const formData = new FormData()
formData.append('file', file)

const response = await api.post('/contracts/upload/', formData, {
  headers: {
    'Content-Type': 'multipart/form-data'
  }
})

// response.data.file_path - 文件路径
// response.data.content.text - 解析的文本
// response.data.content.html - HTML格式内容
```

**后端响应：**
```json
{
  "file_path": "contracts/uploads/xxx.pdf",
  "content": {
    "text": "解析的文本内容",
    "html": "<p>HTML格式内容</p>",
    "metadata": {
      "page_count": 5,
      "word_count": 1000
    }
  }
}
```

### 16.2 审核报告下载

**前端代码：**
```javascript
const url = `/api/reviews/results/${resultId}/download_report/`
const link = document.createElement('a')
link.href = url
link.setAttribute('download', '')
link.click()
```

### 16.3 审核报告预览

**前端代码：**
```javascript
const url = `/api/reviews/results/${resultId}/preview_report/`
window.open(url, '_blank')
```

### 16.4 知识图谱数据获取

**前端代码：**
```javascript
// 获取实体
const entitiesRes = await api.get('/knowledge/entities/')
const entities = entitiesRes.data.results

// 获取关系
const relationsRes = await api.get('/knowledge/relations/')
const relations = relationsRes.data.results

// 构建图谱
const nodes = entities.map(e => ({
  id: e.id,
  name: e.entity_name,
  category: e.entity_type
}))

const links = relations.map(r => ({
  source: r.source_entity_id,
  target: r.target_entity_id,
  value: r.relation_type
}))
```

---

### 16.5 AI生成合同内容

**前端代码：**
```javascript
const response = await api.post('/contracts/contracts/generate_content/', {
  contract_type: 'service',
  industry: 'IT',
  template_id: 1,  // 可选
  basic_info: {
    party_a: '甲方公司',
    party_b: '乙方公司',
    subject: '软件服务',
    amount: '100万元',
    delivery_location: '甲方公司地址',
    delivery_time: '30个工作日内',
    payment_method: '银行转账',
    payment_time: '服务完成后10个工作日内'
  }
})

// response.data.content.text - 生成的合同内容
```

**后端响应：**
```json
{
  "success": true,
  "content": {
    "text": "生成的详细合同内容...",
    "html": "HTML格式内容（可选）",
    "source": "generated"
  },
  "message": "合同内容生成成功"
}
```

### 16.6 审核意见闭环

**汇总审核意见：**
```javascript
const response = await api.post('/reviews/cycles/summarize_opinions/', {
  contract_id: 1,
  review_task_ids: [1, 2, 3]  // 可选
})

// response.data.summary_table - 意见汇总表
```

**反馈给起草人：**
```javascript
const response = await api.post('/reviews/cycles/feedback_to_drafter/', {
  contract_id: 1,
  summary_table: {...},  // 可选，会自动生成
  feedback_message: '请根据审核意见修改合同'
})
```

**重新提交审核：**
```javascript
const response = await api.post('/reviews/cycles/resubmit_for_review/', {
  contract_id: 1,
  change_summary: '根据审核意见修改了违约责任条款'
})
```

---

## 18. 功能完成度统计

### 18.1 前端功能完成度：100% ✅

- ✅ 用户认证与权限管理（100%）
- ✅ 合同管理（100%，含文件上传、富文本编辑）
- ✅ 模板管理（100%）
- ✅ 合同审核（100%，含报告下载预览）
- ✅ 规则引擎（100%）
- ✅ 知识图谱（100%，含可视化）
- ✅ 仪表盘（100%，含数据图表）
- ✅ 部门管理（100%）

### 18.2 后端功能完成度：95% ✅

- ✅ 用户认证与权限管理（100%）
- ✅ 合同管理（100%，含文件上传解析、AI生成）
- ✅ 模板管理（100%，含系统内置模板）
- ✅ 合同审核（100%，含报告下载预览、自动审核、人工审核、意见闭环）
- ✅ 规则引擎（100%，含规则匹配算法）
- ✅ 知识图谱（100%，含关系API优化）
- ✅ AI模型集成（100%，含AI模型配置、审核建议生成、合同生成）
- ⏳ 智能推荐（待实现）

### 18.3 系统优化完成度：40%

- ✅ 路由懒加载（100%）
- ✅ 代码分割（100%）
- ⏳ 缓存机制（待实现）
- ⏳ 数据库优化（待实现）
- ⏳ 单元测试（待实现）

---

## 19. 总结

本系统已完成所有核心业务功能和大部分增强功能：

✅ **完整的CRUD操作**：所有模块都实现了完整的增删改查功能

✅ **数据可视化**：仪表盘和知识图谱都实现了可视化展示

✅ **文件处理**：支持文件上传、解析、下载和预览

✅ **富文本编辑**：支持JSON和富文本两种编辑模式

✅ **性能优化**：路由懒加载和代码分割已实现

✅ **后端API**：文件上传、报告下载预览等API已实现

所有功能均已在Vue前端实现完整的增删改查操作，提供了良好的用户体验和完整的业务功能。

