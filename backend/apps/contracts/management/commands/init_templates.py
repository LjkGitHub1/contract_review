"""
初始化合同模板数据
"""
from django.core.management.base import BaseCommand
from apps.contracts.models import Template
from apps.users.models import User


class Command(BaseCommand):
    help = '初始化合同模板数据'

    def handle(self, *args, **options):
        # 获取或创建管理员用户
        admin_user, _ = User.objects.get_or_create(
            username='admin',
            defaults={'email': 'admin@example.com', 'is_staff': True}
        )
        
        templates_data = [
            {
                'name': '采购合同模板（详细版）',
                'contract_type': 'procurement',
                'industry': '制造业',
                'category': '采购',
                'content': '''采购合同

合同编号：___________

甲方（采购方）：_________________________
地址：___________________________________
法定代表人：_____________________________
联系电话：_____________________________
开户银行：_____________________________
银行账号：_____________________________

乙方（供应方）：_________________________
地址：___________________________________
法定代表人：_____________________________
联系电话：_____________________________
开户银行：_____________________________
银行账号：_____________________________

根据《中华人民共和国合同法》及相关法律法规的规定，甲乙双方在平等、自愿、公平、诚实信用的基础上，就甲方向乙方采购货物事宜，经友好协商，达成如下协议：

第一条 合同标的
1.1 货物名称：_________________________
1.2 货物规格：_________________________
1.3 货物数量：_________________________
1.4 货物单价：人民币___________元/单位
1.5 合同总金额：人民币___________元（大写：_________________________）
1.6 货物质量标准：符合国家相关标准及行业标准，具体标准为：_________________________

第二条 交货方式
2.1 交货地点：_________________________
2.2 交货时间：自合同签订之日起___________个工作日内完成交货
2.3 交货方式：□ 乙方送货上门  □ 甲方自提  □ 第三方物流
2.4 运输方式及费用：_________________________
2.5 包装要求：_________________________

第三条 验收标准及方法
3.1 验收标准：按照本合同第一条约定的质量标准进行验收
3.2 验收方法：_________________________
3.3 验收期限：货物到达交货地点后___________个工作日内完成验收
3.4 验收异议：如甲方对货物质量有异议，应在验收期限内书面通知乙方，乙方应在收到通知后___________个工作日内予以处理

第四条 付款方式
4.1 付款方式：□ 一次性付款  □ 分期付款  □ 其他：_________________________
4.2 付款时间：
    □ 合同签订后___________个工作日内支付合同总金额的___________%
    □ 货物验收合格后___________个工作日内支付合同总金额的___________%
    □ 质保期满后___________个工作日内支付合同总金额的___________%
4.3 付款方式：□ 银行转账  □ 支票  □ 其他：_________________________
4.4 发票要求：乙方应在收到款项后___________个工作日内向甲方开具合法有效的增值税专用发票

第五条 质量保证
5.1 质保期限：自货物验收合格之日起___________个月
5.2 质保范围：在质保期内，如货物出现质量问题，乙方应负责免费维修、更换或退货
5.3 质保责任：因乙方原因导致货物质量问题，给甲方造成损失的，乙方应承担相应的赔偿责任

第六条 违约责任
6.1 甲方违约责任：
    （1）如甲方未按合同约定支付款项，每逾期一日，应向乙方支付逾期付款金额的___________‰作为违约金
    （2）如甲方无正当理由拒绝接收货物，应向乙方支付合同总金额的___________%作为违约金
6.2 乙方违约责任：
    （1）如乙方未按合同约定时间交货，每逾期一日，应向甲方支付合同总金额的___________‰作为违约金
    （2）如乙方交付的货物不符合合同约定的质量标准，甲方有权要求乙方免费更换、退货或减少价款
    （3）如乙方交付的货物存在严重质量问题，甲方有权解除合同，并要求乙方支付合同总金额的___________%作为违约金
6.3 因不可抗力导致合同无法履行的，双方互不承担违约责任

第七条 知识产权
7.1 乙方保证所供货物不侵犯任何第三方的知识产权
7.2 如因乙方提供的货物侵犯第三方知识产权，给甲方造成损失的，乙方应承担全部责任

第八条 保密条款
8.1 双方应对在合同履行过程中知悉的对方商业秘密和技术秘密承担保密义务
8.2 保密期限：自合同签订之日起至合同终止后___________年

第九条 争议解决
9.1 因本合同引起的争议，双方应友好协商解决
9.2 协商不成的，任何一方均可向合同签订地人民法院提起诉讼
9.3 合同签订地：_________________________

第十条 其他约定
10.1 本合同未尽事宜，双方可另行签订补充协议，补充协议与本合同具有同等法律效力
10.2 本合同自双方签字盖章之日起生效
10.3 本合同一式___________份，甲乙双方各执___________份，具有同等法律效力

甲方（盖章）：                   乙方（盖章）：
法定代表人（签字）：             法定代表人（签字）：
委托代理人（签字）：             委托代理人（签字）：
签订日期：________年____月____日  签订日期：________年____月____日''',
                'description': '详细的采购合同模板，包含完整的条款和格式',
                'tags': ['采购', '制造业', '详细'],
                'is_public': True,
            },
            {
                'name': '销售合同模板（详细版）',
                'contract_type': 'sales',
                'industry': '贸易',
                'category': '销售',
                'content': '''销售合同

合同编号：___________

甲方（销售方）：_________________________
地址：___________________________________
法定代表人：_____________________________
联系电话：_____________________________
开户银行：_____________________________
银行账号：_____________________________

乙方（购买方）：_________________________
地址：___________________________________
法定代表人：_____________________________
联系电话：_____________________________
开户银行：_____________________________
银行账号：_____________________________

根据《中华人民共和国合同法》及相关法律法规的规定，甲乙双方在平等、自愿、公平、诚实信用的基础上，就甲方向乙方销售货物事宜，经友好协商，达成如下协议：

第一条 合同标的
1.1 货物名称：_________________________
1.2 货物规格型号：_____________________
1.3 货物数量：_________________________
1.4 货物单价：人民币___________元/单位
1.5 合同总金额：人民币___________元（大写：_________________________）
1.6 货物质量标准：_____________________
1.7 货物产地：_________________________

第二条 交货方式
2.1 交货地点：_________________________
2.2 交货时间：_________________________
2.3 交货方式：□ 甲方送货  □ 乙方自提  □ 第三方物流
2.4 运输方式：_________________________
2.5 运输费用承担：□ 甲方承担  □ 乙方承担
2.6 包装标准：_________________________

第三条 验收标准及方法
3.1 验收标准：按照本合同约定的质量标准进行验收
3.2 验收方法：_________________________
3.3 验收期限：货物到达交货地点后___________个工作日内完成验收
3.4 验收合格：验收合格后，双方签署验收单

第四条 付款方式
4.1 付款方式：□ 预付款  □ 货到付款  □ 分期付款
4.2 付款时间：
    □ 合同签订后___________个工作日内支付预付款___________元
    □ 货物验收合格后___________个工作日内支付余款
4.3 付款方式：□ 银行转账  □ 支票  □ 承兑汇票
4.4 发票：甲方应在收到款项后___________个工作日内开具发票

第五条 质量保证
5.1 质保期限：自货物验收合格之日起___________个月
5.2 质保内容：在质保期内，如货物出现质量问题，甲方应负责免费维修、更换或退货
5.3 质保责任：因货物质量问题给乙方造成损失的，甲方应承担相应责任

第六条 违约责任
6.1 甲方违约责任：
    （1）如甲方未按合同约定时间交货，每逾期一日，应向乙方支付合同总金额的___________‰作为违约金
    （2）如甲方交付的货物不符合合同约定，应承担相应的违约责任
6.2 乙方违约责任：
    （1）如乙方未按合同约定支付款项，每逾期一日，应向甲方支付逾期付款金额的___________‰作为违约金
    （2）如乙方无正当理由拒绝接收货物，应向甲方支付合同总金额的___________%作为违约金
6.3 因不可抗力导致合同无法履行的，双方互不承担违约责任

第七条 知识产权
7.1 甲方保证所售货物不侵犯任何第三方的知识产权
7.2 如因货物侵犯第三方知识产权，给乙方造成损失的，甲方应承担全部责任

第八条 争议解决
8.1 因本合同引起的争议，双方应友好协商解决
8.2 协商不成的，任何一方均可向合同签订地人民法院提起诉讼
8.3 合同签订地：_________________________

第九条 其他约定
9.1 本合同未尽事宜，双方可另行签订补充协议
9.2 本合同自双方签字盖章之日起生效
9.3 本合同一式___________份，甲乙双方各执___________份

甲方（盖章）：                   乙方（盖章）：
法定代表人（签字）：             法定代表人（签字）：
签订日期：________年____月____日  签订日期：________年____月____日''',
                'description': '详细的销售合同模板，适用于各类商品销售',
                'tags': ['销售', '贸易', '详细'],
                'is_public': True,
            },
            {
                'name': '服务合同模板（详细版）',
                'contract_type': 'service',
                'industry': 'IT',
                'category': '服务',
                'content': '''服务合同

合同编号：___________

甲方（委托方）：_________________________
地址：___________________________________
法定代表人：_____________________________
联系电话：_____________________________
电子邮箱：_____________________________

乙方（服务方）：_________________________
地址：___________________________________
法定代表人：_____________________________
联系电话：_____________________________
电子邮箱：_____________________________

根据《中华人民共和国合同法》及相关法律法规的规定，甲乙双方在平等、自愿、公平、诚实信用的基础上，就乙方向甲方提供技术服务事宜，经友好协商，达成如下协议：

第一条 服务内容
1.1 服务项目：_________________________
1.2 服务范围：_________________________
1.3 服务标准：_________________________
1.4 服务期限：自________年____月____日起至________年____月____日止
1.5 服务地点：_________________________

第二条 服务要求
2.1 乙方应按照合同约定的服务标准提供服务
2.2 乙方应配备具有相应资质和能力的服务人员
2.3 乙方应建立完善的服务质量管理体系
2.4 服务过程中，乙方应定期向甲方报告服务进展情况

第三条 服务费用
3.1 服务费用总额：人民币___________元（大写：_________________________）
3.2 费用构成：_________________________
3.3 付款方式：□ 一次性付款  □ 分期付款
3.4 付款时间：
    □ 合同签订后___________个工作日内支付___________%
    □ 服务完成并验收合格后___________个工作日内支付余款
3.5 付款方式：□ 银行转账  □ 支票
3.6 发票：乙方应在收到款项后___________个工作日内开具发票

第四条 验收标准
4.1 验收标准：按照本合同约定的服务标准进行验收
4.2 验收方法：_________________________
4.3 验收期限：服务完成后___________个工作日内完成验收
4.4 验收合格：验收合格后，双方签署验收单

第五条 知识产权
5.1 服务过程中产生的知识产权归属：_________________________
5.2 乙方保证提供的服务不侵犯任何第三方的知识产权
5.3 如因服务内容侵犯第三方知识产权，给甲方造成损失的，乙方应承担全部责任

第六条 保密条款
6.1 双方应对在合同履行过程中知悉的对方商业秘密和技术秘密承担保密义务
6.2 保密期限：自合同签订之日起至合同终止后___________年
6.3 保密范围：_________________________

第七条 违约责任
7.1 甲方违约责任：
    （1）如甲方未按合同约定支付服务费用，每逾期一日，应向乙方支付逾期付款金额的___________‰作为违约金
    （2）如甲方无正当理由终止合同，应向乙方支付合同总金额的___________%作为违约金
7.2 乙方违约责任：
    （1）如乙方未按合同约定提供服务，每逾期一日，应向甲方支付合同总金额的___________‰作为违约金
    （2）如乙方提供的服务不符合合同约定，应免费重新提供服务
    （3）如乙方提供的服务存在严重质量问题，甲方有权解除合同，并要求乙方支付合同总金额的___________%作为违约金
7.3 因不可抗力导致合同无法履行的，双方互不承担违约责任

第八条 合同变更和解除
8.1 合同变更：双方协商一致，可以变更合同内容
8.2 合同解除：出现下列情形之一的，可以解除合同：
    （1）双方协商一致
    （2）因不可抗力导致合同无法履行
    （3）一方严重违约，另一方有权解除合同

第九条 争议解决
9.1 因本合同引起的争议，双方应友好协商解决
9.2 协商不成的，任何一方均可向合同签订地人民法院提起诉讼
9.3 合同签订地：_________________________

第十条 其他约定
10.1 本合同未尽事宜，双方可另行签订补充协议
10.2 本合同自双方签字盖章之日起生效
10.3 本合同一式___________份，甲乙双方各执___________份

甲方（盖章）：                   乙方（盖章）：
法定代表人（签字）：             法定代表人（签字）：
签订日期：________年____月____日  签订日期：________年____月____日''',
                'description': '详细的服务合同模板，适用于各类技术服务',
                'tags': ['服务', 'IT', '详细'],
                'is_public': True,
            },
            {
                'name': '劳动合同模板（详细版）',
                'contract_type': 'labor',
                'industry': '通用',
                'category': '劳动',
                'content': '''劳动合同

合同编号：___________

甲方（用人单位）：_____________________
地址：_________________________________
法定代表人：___________________________
联系电话：_____________________________

乙方（劳动者）：_______________________
身份证号码：___________________________
住址：_________________________________
联系电话：_____________________________

根据《中华人民共和国劳动法》、《中华人民共和国劳动合同法》及相关法律法规的规定，甲乙双方在平等、自愿、公平、诚实信用的基础上，就建立劳动关系事宜，经友好协商，达成如下协议：

第一条 合同期限
1.1 合同期限类型：□ 固定期限  □ 无固定期限  □ 以完成一定工作任务为期限
1.2 固定期限：自________年____月____日起至________年____月____日止
1.3 试用期：自________年____月____日起至________年____月____日止，共________个月

第二条 工作内容和工作地点
2.1 工作岗位：_________________________
2.2 工作内容：_________________________
2.3 工作地点：_________________________
2.4 甲方根据工作需要，可以调整乙方的工作岗位和工作地点，但应提前通知乙方

第三条 工作时间和休息休假
3.1 工作时间：□ 标准工时制  □ 综合计算工时制  □ 不定时工时制
3.2 工作时间：每日工作___________小时，每周工作___________天
3.3 休息休假：按照国家和地方有关规定执行
3.4 带薪年休假：按照国家和地方有关规定执行

第四条 劳动报酬
4.1 工资标准：人民币___________元/月
4.2 工资构成：基本工资___________元，岗位工资___________元，绩效工资___________元，其他：___________
4.3 工资支付方式：每月___________日前支付上月工资
4.4 工资支付方式：□ 银行转账  □ 现金
4.5 试用期工资：不低于转正后工资的___________%

第五条 社会保险和福利待遇
5.1 甲方应按照国家和地方有关规定为乙方缴纳社会保险（养老保险、医疗保险、失业保险、工伤保险、生育保险）
5.2 甲方应按照国家和地方有关规定为乙方缴纳住房公积金
5.3 其他福利待遇：_________________________

第六条 劳动保护和劳动条件
6.1 甲方应为乙方提供符合国家规定的劳动安全卫生条件和必要的劳动防护用品
6.2 甲方应建立健全生产工艺流程，制定操作规程、工作规范和劳动安全卫生制度
6.3 甲方应对乙方进行劳动安全卫生教育，防止劳动过程中的事故，减少职业危害

第七条 保密和竞业限制
7.1 乙方应对在合同履行过程中知悉的甲方商业秘密和技术秘密承担保密义务
7.2 保密期限：自合同签订之日起至合同终止后___________年
7.3 竞业限制：□ 适用  □ 不适用
   如适用，竞业限制期限为合同终止后___________年，竞业限制补偿金为每月___________元

第八条 合同的变更、解除和终止
8.1 合同变更：双方协商一致，可以变更合同内容
8.2 合同解除：出现下列情形之一的，可以解除合同：
    （1）双方协商一致
    （2）乙方提前___________日书面通知甲方
    （3）甲方提前___________日书面通知乙方或支付代通知金
    （4）符合《劳动合同法》规定的其他情形
8.3 合同终止：出现《劳动合同法》规定的终止情形的，合同终止

第九条 违约责任
9.1 如乙方违反保密义务或竞业限制约定，应向甲方支付违约金___________元
9.2 如甲方未按合同约定支付劳动报酬，应按照有关规定支付赔偿金
9.3 其他违约责任：_________________________

第十条 争议解决
10.1 因本合同引起的争议，双方应友好协商解决
10.2 协商不成的，任何一方均可向劳动争议仲裁委员会申请仲裁
10.3 对仲裁裁决不服的，可以向人民法院提起诉讼

第十一条 其他约定
11.1 本合同未尽事宜，按照国家和地方有关规定执行
11.2 本合同自双方签字盖章之日起生效
11.3 本合同一式___________份，甲乙双方各执___________份

甲方（盖章）：                   乙方（签字）：
法定代表人（签字）：              
签订日期：________年____月____日  签订日期：________年____月____日''',
                'description': '详细的劳动合同模板，符合劳动法规定',
                'tags': ['劳动', '通用', '详细'],
                'is_public': True,
            },
        ]
        
        created_count = 0
        updated_count = 0
        
        for template_data in templates_data:
            template, created = Template.objects.update_or_create(
                name=template_data['name'],
                defaults={
                    'contract_type': template_data['contract_type'],
                    'industry': template_data['industry'],
                    'category': template_data['category'],
                    'content': template_data['content'],
                    'description': template_data['description'],
                    'tags': template_data['tags'],
                    'is_public': template_data['is_public'],
                    'created_by': admin_user,
                }
            )
            
            if created:
                created_count += 1
                self.stdout.write(self.style.SUCCESS(f'创建模板: {template.name}'))
            else:
                updated_count += 1
                self.stdout.write(self.style.WARNING(f'更新模板: {template.name}'))
        
        self.stdout.write(self.style.SUCCESS(
            f'\n完成！创建了 {created_count} 个模板，更新了 {updated_count} 个模板'
        ))

